<!DOCTYPE html>
<html lang="es">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes de Infraestructura</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="icon" type="image/png"
            href="{{ url_for('static', filename='pinguino_rel_icon.webp')}}">
</head>
<body>
    <!-- Video de fondo -->
    <div class="video-background">
        <video autoplay muted loop playsinline>
            <source src="{{ url_for('static', filename='animaciones_del_fondo.mp4') }}" type="video/mp4">
        </video>
    </div>

    <!-- Navegacion -->
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">REPORTES CIUDADANOS</h1>
            <div class="nav-links">
                <button class="nav-btn active" data-seccion="lista"
                        onclick="mostrarSeccion('lista')">Reportes</button>

                {% if correo %}
                <button class="nav-btn" data-seccion="crear"
                        onclick="mostrarSeccion('crear')">Crear Reporte</button>
                {% endif %}

                <button class="nav-btn" data-seccion="mapa"
                        onclick="mostrarSeccion('mapa')">Mapa</button>

                {% if rol == 'admin' %}
                <button class="nav-btn" data-seccion="analiticas"
                        onclick="mostrarSeccion('analiticas')">Analiticas</button>
                {% endif %}

                {% if correo %}
                    <!-- Usuario logueado -->
                    <a href="/logout" class="nav-btn">Cerrar sesión</a>
                {% else %}
                    <!-- Usuario no logueado -->
                    <a href="/login" class="nav-btn">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Contenedor principal -->
    <div class="container main-content">

        <!-- Sección: Crear Reporte -->
        <section id="seccion-crear" class="seccion">
            <h2>Crear Nuevo Reporte</h2>
            <p class="descripcion">Reporta baches y problemas de infraestructura en tu comunidad</p>

            <form id="form-crear-reporte" class="form-card">
                <div class="form-group">
                    <label>Ubicacion en el mapa *</label>

                    <div id="map" style="height: 300px; border-radius: 8px;"></div>

                    <input type="hidden" id="lat" name="lat" required>
                    <input type="hidden" id="lng" name="lng" required>

                    <small>Toca el mapa para marcar la ubicación exacta</small>
                </div>

                <div class="form-group">
                    <label for="ubicacion">Referencia</label>
                    <input
                        type="text"
                        id="ubicacion"
                        name="ubicacion"
                        placeholder="Alguna referencia..."
                    >
                    <small>Mínimo 5 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="categoria">Categoría *</label>
                    <select id="categoria" name="categoria" required>
                        <option value="Vías y Tránsito">Vías y Tránsito</option>
                        <option value="Alumbrado Público">Alumbrado Público</option>
                        <option value="Agua y Saneamiento">Agua y Saneamiento</option>
                        <option value="Residuos y Limpieza">Residuos y Limpieza</option>
                        <option value="Parques y Espacios Públicos">Parques y Espacios Públicos</option>
                        <option value="Electricidad y Telecomunicaciones">Electricidad y Telecomunicaciones</option>
                        <option value="Edificaciones Públicas">Edificaciones Públicas</option>
                        <option value="Seguridad Urbana">Seguridad Urbana</option>
                        <option value="Transporte Público">Transporte Público</option>
                        <option value="Otros">Otros</option>
                    </select>
                    <small>Selecciona la categoría más apropiada</small>
                </div>

                <div class="form-group">
                    <label for="comentario">Descripcion del Problema *</label>
                    <textarea
                        id="comentario"
                        name="comentario"
                        rows="4"
                        placeholder="Describe el problema: tamaño, ubicación exacta, peligrosidad, etc."
                        required
                    ></textarea>
                    <small>Mi­nimo 10 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="foto">Foto del Problema *</label>
                    <input
                        type="file"
                        id="foto"
                        name="foto"
                        accept="image/*"
                        capture="environment"
                        required
                    >

                    <small>Formatos: JPG, PNG, WEBP - Maximo 5MB</small>
                </div>

                <div class="form-group">
                    <label for="email">Email (Opcional)</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="tu@email.com"
                    >
                    <small>Para recibir notificaciones sobre tu reporte</small>
                </div>

                <button type="submit" class="btn btn-primary">Enviar Reporte</button>
            </form>

            <div id="mensaje-crear" class="mensaje oculto"></div>
        </section>

        <!-- Sección: Reportes -->
        <section id="seccion-lista" class="seccion">
            <h2>Reportes</h2>
            <p class="descripcion">Visualiza y gestiona todos los reportes de la comunidad</p>

            <!-- Filtros -->
            <div class="filtros">
                <label for="filtro-estado">Filtrar por estado:</label>
                <select id="filtro-estado" onchange="cargarReportes()">
                    <option value="Todos">Todos</option>
                    <option value="Pendiente">Pendiente</option>
                    <option value="Verificando">Verificando</option>
                    <option value="Solucionado">Solucionado</option>
                    <option value="Rechazado">Rechazado</option>
                </select>
            </div>

            <!-- Grid de reportes -->
            <div id="lista-reportes" class="reportes-grid">
                <p class="cargando">Cargando reportes...</p>
            </div>
        </section>

        <!-- Sección: Analíticas (solo admin) -->
        {% if rol == 'admin' %}
        <section id="seccion-analiticas" class="seccion">
            <h2>Anali­ticas</h2>
            <p class="descripcion">Estadi­sticas generales del sistema</p>

            <!-- Estadi­sticas en tarjetas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat-total">0</h3>
                    <p>Total Reportes</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-pendiente">0</h3>
                    <p>Pendientes</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-verificando">0</h3>
                    <p>Verificando</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-solucionado">0</h3>
                    <p>Solucionados</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-rechazado">0</h3>
                    <p>Rechazados</p>
                </div>
            </div>

            <!-- Grafico de barras -->
            <div class="analiticas-grafico">
                <h3>Distribucion por Estado</h3>
                <div class="grafico-barra">
                    <div class="barra-item">
                        <span class="barra-label">Pendiente</span>
                        <div class="barra-contenedor">
                            <div id="barra-pendiente" class="barra estado-pendiente" style="width: 0%"></div>
                        </div>
                        <span id="valor-pendiente" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Verificando</span>
                        <div class="barra-contenedor">
                            <div id="barra-verificando" class="barra estado-verificando" style="width: 0%"></div>
                        </div>
                        <span id="valor-verificando" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Solucionado</span>
                        <div class="barra-contenedor">
                            <div id="barra-solucionado" class="barra estado-solucionado" style="width: 0%"></div>
                        </div>
                        <span id="valor-solucionado" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Rechazado</span>
                        <div class="barra-contenedor">
                            <div id="barra-rechazado" class="barra estado-rechazado" style="width: 0%"></div>
                        </div>
                        <span id="valor-rechazado" class="barra-valor">0</span>
                    </div>
                </div>
            </div>

            <!-- Reportes recientes -->
            <div class="analiticas-recientes">
                <h3>Reportes Recientes</h3>
                <div id="reportes-recientes" class="reportes-grid">
                    <p class="cargando">Cargando...</p>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Sección: Mapa -->
        <section id="seccion-mapa" class="seccion seccion-mapa">
            <div id="mapa-reportes"></div>
        </section>


    </div>


    <!-- Modal para ver detalles de un reporte -->
    <div id="modal-reporte" class="modal oculto">
        <div class="modal-content">
            <span class="modal-close" onclick="cerrarModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    <script src="/static/script.js"></script>
</body>
</html>